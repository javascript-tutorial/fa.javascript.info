# Bezier curve

منحنی های Bezier در گرافیک کامپیوتری برای ترسیم اشکال، برای انیمیشن های CSS و در بسیاری از مکان های دیگر استفاده می شود.

آنها چیز بسیار ساده ای هستند، ارزش یک بار مطالعه و سپس احساس راحتی در دنیای گرافیک های برداری و انیمیشن های پیشرفته را دارند.

```smart header="Some theory, please"
این مقاله بینشی نظری، اما بسیار مورد نیاز در مورد اینکه منحنی های Bezier چیست، ارائه می دهد، در حالی که [مطلب بعدی] (info:css-animations#bezier-curve) نشان می دهد که چگونه می توانیم از آنها برای انیمیشن های CSS استفاده کنیم.

لطفاً وقت خود را صرف مطالعه و درک مفهوم کنید، این به شما کمک خواهد کرد.
```

## نقاط کنترلی

یگ [bezier curve](https://en.wikipedia.org/wiki/B%C3%A9zier_curve) توسط control points تعریف می شود.

ممکن است 2، 3، 4 یا بیشتر وجود داشته باشد.

به عنوان مثال منحنی دو نقطه:

![](bezier2.svg)

منحنی سه نقطه:

![](bezier3.svg)

منحنی چهار نقطه:

![](bezier4.svg)

اگر به این منحنی ها دقت کنید، بلافاصله متوجه می شوید:

1. **نقاط همیشه روی منحنی نیستند.** این کاملا طبیعی است، بعداً خواهیم دید که منحنی چگونه ساخته می شود.
2. **ترتیب منحنی برابر است با تعداد نقاط منهای یک**.
برای دو نقطه یک منحنی خطی داریم (این یک خط مستقیم است)، برای سه نقطه - منحنی درجه دوم (پارابولیک)، برای چهار نقطه - منحنی مکعبی.
3. **یک منحنی همیشه در داخل [بدنه محدب](https://en.wikipedia.org/wiki/Convex_hull) نقاط کنترل است:**

     ![](bezier4-e.svg) ![](bezier3-e.svg)

به دلیل آخرین ویژگی، در گرافیک کامپیوتری امکان بهینه سازی تست های تقاطع وجود دارد. اگر بدنه های محدب همدیگر را قطع نمی کنند، منحنی ها هم قطع نمی شوند. بنابراین بررسی تقاطع بدنه محدب ابتدا می تواند یک نتیجه بسیار سریع "بدون تقاطع" بدهد. بررسی تقاطع بدنه‌های محدب بسیار ساده‌تر است، زیرا آنها مستطیل، مثلث و غیره هستند (تصویر بالا را ببینید)، ارقام بسیار ساده‌تر از منحنی.

**مقدار اصلی منحنی های Bezier برای ترسیم -- با جابجایی نقاط منحنی در حال تغییر است *به صورت واضح*.**

سعی کنید نقاط کنترل را با استفاده از ماوس در مثال زیر جابجا کنید:

[iframe src="demo.svg?nocpath=1&p=0,0,0.5,0,0.5,1,1,1" height=370]

**همانطور که متوجه شدید، منحنی در امتداد خطوط مماسی 1 -> 2 و 3 -> 4 کشیده می شود.**

پس از مدتی تمرین، نحوه قرار دادن نقاط برای به دست آوردن منحنی مورد نیاز آشکار می شود. و با اتصال چندین منحنی عملاً می توانیم هر چیزی را بدست آوریم.

در اینجا چند نمونه آورده شده است:

![](bezier-car.svg) ![](bezier-letter.svg) ![](bezier-vase.svg)

## De Casteljau's الگوریتم

یک فرمول ریاضی برای منحنی های Bezier وجود دارد، اما اجازه دهید کمی بعد آن را پوشش دهیم، زیرا
[الگوریتم De Casteljau](https://en.wikipedia.org/wiki/De_Casteljau%27s_algorithm) با تعریف ریاضی یکسان است و به صورت بصری نحوه ساخت آن را نشان می دهد.

ابتدا بیایید مثال 3 امتیازی را ببینیم.

در اینجا نسخه ی نمایشی است، و توضیح در ادامه.

نقاط کنترل (1،2 و 3) را می توان توسط ماوس جابجا کرد. دکمه 'play' را فشار دهید تا اجرا شود.

[iframe src="demo.svg?p=0,0,0.5,1,1,0&animate=1" height=370]

**الگوریتم De Casteljau برای ساخت منحنی 3 نقطه ای بزیر:**

1. نقاط کنترل را ترسیم کنید. در نسخه ی نمایشی بالا آنها با برچسب: '1'، '2'، '3'.
2. ساخت بخش ها بین نقاط کنترل 1 -> 2 -> 3. در نسخه نمایشی بالا آنها <span style="color:#825E28">قهوه ای</span> هستند.
3. پارامتر 't' از'0' به '1' حرکت می کند. در مثال بالا از مرحله '0.05' استفاده شده است: حلقه از '0، 0.05، 0.1، 0.15، ... 0.95، 1' می رود.

     برای هر یک از این مقادیر `t`:

     - در هر قطعه <span style="color:#825E28">قهوه ای</span>، نقطه ای را در فاصله متناسب با "t" از ابتدای آن در نظر می گیریم. از آنجایی که دو بخش وجود دارد، ما دو نقطه داریم.

         به عنوان مثال، برای `t=0` -- هر دو نقطه در ابتدای بخش ها خواهند بود و برای `t=0.25` -- در 25% طول قطعه از ابتدا، برای `t=0.5` -- 50 % (وسط)، برای `t=1` -- در انتهای بخش ها.

     - نقاط را به هم وصل کنید. در تصویر زیر بخش اتصال <span style="color:#167490">آبی</span> رنگ آمیزی شده است.


| For `t=0.25`             | For `t=0.5`            |
| ------------------------ | ---------------------- |
| ![](bezier3-draw1.svg)   | ![](bezier3-draw2.svg) |

4. اکنون در بخش <span style="color:#167490">آبی</span> یک نقطه از فاصله متناسب با همان مقدار 't' بگیرید. یعنی برای `t=0.25` (تصویر سمت چپ) یک نقطه در انتهای ربع سمت چپ بخش داریم و برای `t=0.5` (تصویر سمت راست) -- در وسط قطعه. در تصاویر بالای آن نقطه <span style="color:red">قرمز</span> است.

5. از آنجایی که 't' از '0' تا '1' اجرا می‌شود، هر مقدار 't' یک نقطه به منحنی اضافه می‌کند. مجموعه چنین نقاطی منحنی بزیه را تشکیل می دهد. در تصاویر بالا قرمز و سهمی است.

این یک روند برای 3 امتیاز بود. اما برای 4 امتیاز همینطور است.

نسخه ی نمایشی برای 4 امتیاز (امتیازها را می توان با ماوس جابه جا کرد):

[iframe src="demo.svg?p=0,0,0.5,0,0.5,1,1,1&animate=1" height=370]

الگوریتم 4 نقطه:

- نقاط کنترل را بر اساس بخش ها وصل کنید: 1 -> 2، 2 -> 3، 3 -> 4. 3 قطعه <span style="color:#825E28">قهوه ای</span> وجود خواهد داشت.
- برای هر 't' در بازه '0' تا '1':
     - از ابتدا روی این بخش ها در فاصله متناسب با «t» امتیاز می گیریم. این نقاط به هم متصل می شوند، به طوری که ما دو <span style="color:#0A0">قطع سبز</span> داریم.
     - در این بخش ها نقاطی متناسب با 't' می گیریم. ما یک <span style="color:#167490">بخش آبی</span> دریافت می کنیم.
     - در قسمت آبی یک نقطه متناسب با 't' می گیریم. در مثال بالا <span style="color:red">قرمز</span> است.
- این نقاط با هم منحنی را تشکیل می دهند.

الگوریتم بازگشتی است و برای هر تعداد نقطه کنترل قابل تعمیم است.

با توجه به N از نقاط کنترل:

1. ما آنها را به هم وصل می کنیم تا در ابتدا بخش های N-1 را بدست آوریم.
2. سپس برای هر 't' از '0' تا '1'، روی هر قسمت در فاصله متناسب با 't' یک نقطه می گیریم و آنها را به هم وصل می کنیم. بخش N-2 وجود خواهد داشت.
3. مرحله 2 را تکرار کنید تا تنها یک نقطه باقی بماند.

این نقاط منحنی را می سازند.

```online
**Run and pause examples to clearly see the segments and how the curve is built.**
```


منحنی که شبیه «y=1/t» است:

[iframe src="demo.svg?p=0,0,0,0.75,0.25,1,1,1&animate=1" height=370]

نقاط کنترل زیگزاگ نیز به خوبی کار می کنند:

[iframe src="demo.svg?p=0,0,1,0.5,0,0.5,1,1&animate=1" height=370]

ایجاد یک حلقه امکان پذیر است:

[iframe src="demo.svg?p=0,0,1,0.5,0,1,0.5,0&animate=1" height=370]

یک منحنی غیر صاف Bezier (آره، این هم ممکن است):

[iframe src="demo.svg?p=0,0,1,1,0,1,1,0&animate=1" height=370]

```online
اگر چیزی در توضیح الگوریتم نامشخص است، لطفاً به مثال‌های زنده بالا نگاه کنید تا ببینید چگونه
منحنی ساخته شده است.
```

از آنجایی که الگوریتم بازگشتی است، می توانیم منحنی های Bezier را با هر ترتیبی بسازیم، یعنی: با استفاده از 5، 6 یا بیشتر نقطه کنترل. اما در عمل بسیاری از نکات کمتر مفید هستند. معمولاً 2-3 نقطه می گیریم و برای خطوط پیچیده چندین منحنی را به هم می چسبانیم. توسعه و محاسبه آن ساده تر است.

```smart header="How to draw a curve *through* given points?"
برای تعیین منحنی Bezier، از نقاط کنترل استفاده می شود. همانطور که می بینیم، آنها در منحنی نیستند، به جز اولین و آخرین.

گاهی اوقات کار دیگری داریم: ترسیم منحنی *از میان چندین نقطه*، به طوری که همه آنها روی یک منحنی صاف قرار گیرند. این کار [interpolation] (https://en.wikipedia.org/wiki/Interpolation) نامیده می شود و در اینجا ما آن را پوشش نمی دهیم.

فرمول های ریاضی برای چنین منحنی هایی وجود دارد، به عنوان مثال [چند جمله ای لاگرانژ] (https://en.wikipedia.org/wiki/Lagrange_polynomial). در گرافیک کامپیوتری [اسپلاین درون یابی] (https://en.wikipedia.org/wiki/Spline_interpolation) اغلب برای ایجاد منحنی های صاف که نقاط زیادی را به هم متصل می کند، استفاده می شود.
```


## ریاضی

منحنی بزیه را می توان با استفاده از یک فرمول ریاضی توصیف کرد.

همانطور که دیدیم - در واقع نیازی به دانستن آن نیست، اکثر مردم فقط با حرکت دادن نقاط با ماوس منحنی را ترسیم می کنند. اما اگر به ریاضیات علاقه دارید - اینجاست.

با توجه به مختصات نقاط کنترل <code>P<sub>i</sub></code>: اولین نقطه کنترل دارای مختصات <code>P<sub>1</sub> = (x<sub>1</ sub>، y<sub>1</sub>)</code>، دوم: <code>P<sub>2</sub> = (x<sub>2</sub>، y<sub>2 </sub>)</code>، و به همین ترتیب، مختصات منحنی با معادله ای توصیف می شوند که به پارامتر 't' از بخش '[0،1]' بستگی دارد.

- فرمول منحنی 2 نقطه ای:

     <code>P = (1-t)P<sub>1</sub> + tP<sub>2</sub></code>
- برای 3 نقطه کنترل:

     <code>P = (1−t)<sup>2</sup>P<sub>1</sub> + 2(1−t)tP<sub>2</sub> + t<sup>2< /sup>P<sub>3</sub></code>
- برای 4 نقطه کنترل:

     <code>P = (1−t)<sup>3</sup>P<sub>1</sub> + 3(1−t)<sup>2</sup>tP<sub>2</sub > +3(1−t)t<sup>2</sup>P<sub>3</sub> + t<sup>3</sup>P<sub>4</sub></code>


اینها معادلات برداری هستند. به عبارت دیگر، می‌توانیم 'x' و 'y' را به جای 'P' قرار دهیم تا مختصات مربوطه را بدست آوریم.

به عنوان مثال، منحنی 3 نقطه ای توسط نقاط '(x,y)' تشکیل می شود که به صورت زیر محاسبه می شود:

- <code>x = (1−t)<sup>2</sup>x<sub>1</sub> + 2(1−t)tx<sub>2</sub> + t<sup>2 </sup>x<sub>3</sub></code>
- <code>y = (1−t)<sup>2</sup>y<sub>1</sub> + 2(1−t)ty<sub>2</sub> + t<sup>2 </sup>y<sub>3</sub></code>

به جای <code>x<sub>1</sub>، y<sub>1</sub>، x<sub>2</sub>، y<sub>2</sub>، x<sub>3 </sub>، y<sub>3</sub></code> باید مختصات 3 نقطه کنترل را قرار دهیم، و سپس با انتقال 't' از '0' به '1'، برای هر مقدار 't' '(x,y)' از منحنی را خواهیم داشت.

به عنوان مثال، اگر نقاط کنترل '(0،0)'، '(0.5، 1)' و '(1، 0)' باشند، معادلات تبدیل می شوند:

- <code>x = (1−t)<sup>2</sup> * 0 + 2(1−t)t * 0.5 + t<sup>2</sup> * 1 = (1-t)t + t<sup>2</sup> = t</code>
- <code>y = (1−t)<sup>2</sup> * 0 + 2(1−t)t * 1 + t<sup>2</sup> * 0 = 2(1-t) t = –2t<sup>2</sup> + 2t</code>

اکنون که «t» از '0' تا '1' اجرا می شود، مجموعه مقادیر '(x,y)' برای هر 't' منحنی چنین نقاط کنترلی را تشکیل می دهد.

## خلاصه

منحنی های Bezier با نقاط کنترل آنها تعریف می شوند.

ما دو تعریف از منحنی های Bezier دیدیم:

1. استفاده از فرآیند ترسیم: الگوریتم De Casteljau.
2. استفاده از فرمول های ریاضی.

خواص خوب منحنی های Bezier:

- با حرکت دادن نقاط کنترل می توانیم خطوط صاف را با موس ترسیم کنیم.
- اشکال پیچیده را می توان از چندین منحنی Bezier ساخت.

استفاده:

- در گرافیک کامپیوتری، مدل سازی، ویرایشگرهای گرافیکی برداری. فونت ها با منحنی های Bezier توصیف می شوند.
- در توسعه وب -- برای گرافیک روی بوم و در قالب SVG. به هر حال، مثال های 'زنده' بالا در SVG نوشته شده اند. آنها در واقع یک سند SVG هستند که نقاط مختلفی به عنوان پارامتر به آنها داده می شود. می توانید آن را در یک پنجره جداگانه باز کنید و منبع را ببینید: [demo.svg](demo.svg?p=0,0,1,0.5,0,0.5,1,1&animate=1).
- در انیمیشن CSS برای توصیف مسیر و سرعت انیمیشن.
